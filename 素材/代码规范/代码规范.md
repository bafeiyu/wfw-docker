# 代码规范

## 命名规范

>【强制】代码中的命名均不能以下划线或美元符号开始，也不能以下划线或美元符号结束。

```
反例：
_name / __name / Object / name_ / name$ / Object$
```

>【强制】代码中的命名严禁使用拼音与英文混合的方式，更不允许直接使用中文的方式。

```
通用的名称可视为英文使用，正确的英文拼写和语法可以让阅读者易于理解，避免歧义。即使纯拼音命名方式 也要避免采用：
alibaba / taobao / youku / hangzhou 
反例：
DaZhePromotion [打折] / getPingfenByName() [评分]
```

>【强制】类名使用 UpperCamelCase 风格，必须遵从驼峰形式，但以下情形例外:DO / BO / DTO / VO / AO

```
正例：
MarcoPolo / UserDO / XmlService / TcpUdpDeal / TaPromotion
反例：
macroPolo / UserDo / XMLService / TCPUDPDeal / TAPromotion
```

>【强制】方法名、参数名、成员变量、局部变量都统一使用 lowerCamelCase 风格，必须遵从 驼峰形式。

```
正例：
localValue / getHttpMessage() / inputUserId
```

>【强制】常量命名全部大写，单词间用下划线隔开，力求语义表达完整清楚，不要嫌名字长。

```
正例：
MAX_STOCK_COUNT
反例：
MAX_COUNT
```

> 强制】抽象类命名使用 Abstract 或 Base 开头;异常类命名使用 Exception 结尾;测试类 命名以它要测试的类的名称开始，以 Test 结尾。

> 【强制】杜绝完全不规范的缩写，避免望文不知义。  

```
AbstractClass“缩写”命名成 AbsClass;condition“缩写”命名成 condi，此类随 意缩写严重降低了代码的可阅读性。
```

> 【推荐】为了达到代码自解释的目标，任何自定义编程元素在命名时，使用尽量完整的单词 组合来表达其意。

```
正例：
从远程仓库拉取代码的类命名为 PullCodeFromRemoteRepository。
```

> 【推荐】如果模块、接口、类、方法使用了设计模式，在命名时体现出具体模式。 说明:将设计模式体现在名字中，有利于阅读者快速理解架构设计理念。 

```
public class OrderFactory;  
public class LoginProxy;  
public class ResourceObserver;
```

**【参考】各层命名规约:** 

```
A) Service/Repository层方法命名规约  
    1) 获取单个对象的方法用get做前缀。  
    2) 获取多个对象的方法用list做前缀。  
    3) 获取统计值的方法用count做前缀。  
    4) 插入的方法用save/insert做前缀。  
    5) 删除的方法用remove/delete做前缀。  
    6) 修改的方法用update做前缀。  
B) 各层对象命名规范
	1) 接口类统一添加后缀Interface
    2) 抽象类统一添加前缀Base
    3) Controller/Entity/RepositoryManager/Service/Util/Request/Listener/Aspect/Factory/Event 统一以目录名称作		 为后缀
    4) Rpc服务类不需要后缀，为了业务service区分开  
    5) Constants枚举类/Annotation注解 不需要后缀
```

## 常量

> 【推荐】不要使用一个常量类维护所有常量，按常量功能进行归类，分开维护。大而全的常量类，非得使用查找功能才能定位到修改的常量，不利于理解和维护。 

## 注释 

> 【强制】类、类属性、类方法的注释必须使用 Javadoc 规范，使用/**内容*/格式，不得使用 // xxx 方式。

```
在 IDE 编辑窗口中，Javadoc 方式会 示相关注释，生成 Javadoc 可以正确输出相应注 释;在 IDE 中，工程调用方法时，不进入方法即可悬浮 示方法、参数、返回值的意义， 高 阅读效率。
```

> 【强制】所有的抽象方法(包括接口中的方法)必须要用 Javadoc 注释、除了返回值、参数、 异常说明外，还必须指出该方法做什么事情，实现什么功能。 

```
对子类的实现要求，或者调用注意事项，请一并说明。
```

> 【强制】所有的类都必须添加创建者和创建日期。

> 【强制】方法内部单行注释，在被注释语句上方另起一行，使用//注释。方法内部多行注释使用/ /注释，注意与代码对齐。

> 【推荐】与其“半吊子”英文来注释，不如用中文注释把问题说清楚。专有名词与关键字保持 英文原文即可。 

> 【推荐】代码修改的同时，注释也要进行相应的修改，尤其是参数、返回值、异常、核心逻辑 等的修改。 

> 【参考】谨慎注释掉代码。在上方详细说明，而不是简单地注释掉。如果无用，则删除。 ?> 代码被注释掉有两种可能性:1)后续会恢复此段代码逻辑。2)永久不用。前者如果没 有备注信息，难以知晓注释动机。后者建议直接删掉(代码仓库保存了历史代码)。

> 【参考】对于注释的要求:第一、能够准确反应设计思想和代码逻辑;第二、能够 述业务含 义，使别的程序员能够迅速了解到代码背后的信息。完全没有注释的大段代码对于阅读者形同 天书，注释是给自己看的，即使隔很长时间，也能清晰理解当时的思路;注释也是给继任者看 的，使其能够快速接替自己的工作。

> 【参考】好的命名、代码结构是自解释的，注释力求精简准确、表达到位。避免出现注释的一个极端:过多过滥的注释，代码的逻辑一旦修改，修改注释是相当大的负担。

## 类型约束和返回值

> 【强制】所有的方法，函数的入参和返回结果，如果属于基本类型，必须加上基本类型约束。如 int/float/string/array/Object/callbale/void , 如果类型为不确定的泛型，也要在注释中给予完整的标注。

> 【强制】返回值必须为注释和约束的类型，否则则抛出异常，而不是返回一个错误类型的值

> 【推荐】对外的接口(restful/rpc)，返回格式须包括： 【状态码】【 信息】【 数据】

## 数据库操作

> 【强制】数据库操作使用模型和仓库操作，不能使用Db类

> 【强制】所有依赖外部参数的数据库写操作，写入时需要指定需要的字段插入，不能直接使用外部参数作为数据库字段。

> 【强制】对外的查询接口，必须指明需要的字段，不可以用  select '*'

## 错误码保存器

```
/**
* 0 无错误
* 1000 ~ 1999 参数错误码 （参数校验失败，格式有误）
* 2000 ~ 2999 客户端异常 （用户状态异常，权限校验失败。。。）
* 3000 ~ 3999 业务错误码 （数据获取失败，返回数据异常，数据操作失败，主动捕获的异常状态。。。）
* 4000 ~ 4999 异常错误码 （系统异常、php错误）
*
* note: 1000 ~ 3999 是可以传递给外部接口和客户端的 4000 ~ 错误信息记录到日志，不能传递到外部
*/
```



# hyperf基础功能组件

https://github.com/dinofei/hyperf-core.git



> 依赖组件

1. hyperf/constants
2. hyperf/logger
3. hyperf/validation



> 提供的功能：

1. 控制器基类
2. 模型抽基类
3. 验证器基类
4. 通用异常类 业务层异常类 数据层异常类
5. 错误码枚举类 状态码枚举类 成功码枚举类
6. 统一的异常捕获 
7. 数据库写操作日志
8. 日志工具类
9. 统一的返回方法






